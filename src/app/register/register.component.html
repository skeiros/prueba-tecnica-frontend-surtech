<div class="container">
  <mat-card class="m-4 p-4">
    <mat-card-header class="mb-4 text-center p-0">
      <h1 class="text-center w-full font-bold">{{ "TITLE" | translate }}</h1>
    </mat-card-header>

    <form [formGroup]="registerForm" autocomplete="off">
      <div class="grid lg:grid-cols-4 gap-4 sm:grid-cols-2">
        <!--FULLNAME-->
        <mat-form-field appearance="fill" class="full col-span-2">
          <mat-label>{{ "REGISTER.FULLNAME" | translate }}</mat-label>
          <input matInput formControlName="fullname" autocomplete="off" />
          <mat-error
            *ngIf="
              registerForm.get('fullname')?.touched &&
              registerForm.get('fullname')?.hasError('required')
            "
          >
            {{ "ERRORS.REQUIRED" | translate }}
          </mat-error>
          <mat-error
            *ngIf="
              registerForm.get('fullname')?.touched &&
              registerForm.get('fullname')?.hasError('minlength')
            "
          >
            {{ "ERRORS.MIN_LENGTH" | translate : { length: 3 } }}
          </mat-error>
        </mat-form-field>

        <!--EMAIL-->
        <mat-form-field appearance="fill" class="full col-span-2">
          <mat-label>{{ "REGISTER.EMAIL" | translate }}</mat-label>
          <input matInput formControlName="email" autocomplete="off" />
          <mat-error
            *ngIf="
              registerForm.get('email')?.touched &&
              registerForm.get('email')?.hasError('required')
            "
          >
            {{ "ERRORS.REQUIRED" | translate }}
          </mat-error>
          <mat-error
            *ngIf="
              registerForm.get('email')?.touched &&
              registerForm.get('email')?.hasError('email')
            "
          >
            {{ "ERRORS.INVALID_EMAIL" | translate }}
          </mat-error>
        </mat-form-field>

        <!-- PHONE PREFIX (1 column) -->
        <mat-form-field appearance="fill" class="col-span-1">
          <mat-label>{{ "REGISTER.PHONE_PREFIX" | translate }}</mat-label>
          <input matInput formControlName="phone_prefix" autocomplete="off" />
          <mat-error
            *ngIf="
              registerForm.get('phone_prefix')?.touched &&
              registerForm.get('phone_prefix')?.hasError('required')
            "
          >
            {{ "ERRORS.REQUIRED" | translate }}
          </mat-error>
          <mat-error
            *ngIf="
              registerForm.get('phone_prefix')?.touched &&
              registerForm.get('phone_prefix')?.hasError('pattern')
            "
          >
            {{ "ERRORS.PHONE_PREFIX_PATTERN" | translate }}
          </mat-error>
        </mat-form-field>

        <!-- PHONE NUMBER (3 columns) -->
        <mat-form-field appearance="fill" class="lg:col-span-3 sm:col-span-1">
          <mat-label>{{ "REGISTER.PHONE_NUMBER" | translate }}</mat-label>
          <input
            matInput
            formControlName="phone_number"
            mask="000-0000"
            autocomplete="off"
          />
          <mat-error
            *ngIf="
              registerForm.get('phone_number')?.touched &&
              registerForm.get('phone_number')?.hasError('required')
            "
          >
            {{ "ERRORS.REQUIRED" | translate }}
          </mat-error>
        </mat-form-field>

        <!--DATE OF BIRTH-->
        <mat-form-field appearance="fill" class="full col-span-2">
          <mat-label>{{ "REGISTER.DATE_OF_BIRTH" | translate }}</mat-label>
          <input
            matInput
            (click)="picker.open()"
            [matDatepicker]="picker"
            formControlName="date_of_birth"
            autocomplete="off"
          />
          <mat-datepicker-toggle
            matSuffix
            [for]="picker"
          ></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
          <mat-error
            *ngIf="
              registerForm.get('date_of_birth')?.touched &&
              registerForm.get('date_of_birth')?.hasError('required')
            "
          >
            {{ "ERRORS.REQUIRED" | translate }}
          </mat-error>
          <mat-error
            *ngIf="
              registerForm.get('date_of_birth')?.touched &&
              registerForm.get('date_of_birth')?.hasError('minAge')
            "
          >
            {{ "ERRORS.MIN_AGE" | translate }}
          </mat-error>
        </mat-form-field>

        <!--COUNTRY-->
        <mat-form-field appearance="fill" class="full col-span-2">
          <mat-label>{{ "REGISTER.COUNTRY" | translate }}</mat-label>
          <mat-select formControlName="country">
            <mat-option
              *ngFor="let country of countries"
              [value]="country.name"
            >
              {{ country.name }}
            </mat-option>
          </mat-select>

          <mat-icon matSuffix>public</mat-icon>
          <mat-error
            *ngIf="
              registerForm.get('country')?.touched &&
              registerForm.get('country')?.hasError('required')
            "
          >
            {{ "ERRORS.REQUIRED" | translate }}
          </mat-error>
        </mat-form-field>

        <!--PASSWORD-->
        <mat-form-field appearance="fill" class="full col-span-2">
          <mat-label>{{ "REGISTER.PASSWORD" | translate }}</mat-label>
          <input
            matInput
            [type]="showPassword ? 'text' : 'password'"
            formControlName="password"
          />
          <button
            mat-icon-button
            matSuffix
            (click)="showPassword = !showPassword"
            [attr.aria-label]="'Show password'"
            [attr.aria-pressed]="showPassword"
          >
            <mat-icon>{{
              showPassword ? "visibility" : "visibility_off"
            }}</mat-icon>
          </button>

          <mat-error
            *ngIf="
              registerForm.get('password')?.touched &&
              registerForm.get('password')?.hasError('required')
            "
          >
            {{ "ERRORS.REQUIRED" | translate }}
          </mat-error>
          <mat-error
            *ngIf="
              registerForm.get('password')?.touched &&
              registerForm.get('password')?.hasError('minlength')
            "
          >
            {{ "ERRORS.MIN_LENGTH" | translate : { length: 8 } }}
          </mat-error>
          <mat-error
            *ngIf="
              registerForm.get('password')?.touched &&
              registerForm.get('password')?.hasError('passwordStrength') &&
              !registerForm.get('password')?.hasError('minlength')
            "
          >
            {{ "ERRORS.PASSWORD_STRENGTH" | translate }}
          </mat-error>
        </mat-form-field>

        <!--CONFIRM PASSWORD-->
        <mat-form-field appearance="fill" class="full col-span-2">
          <mat-label>{{ "REGISTER.CONFIRM_PASSWORD" | translate }}</mat-label>
          <input
            matInput
            [type]="showConfirmPassword ? 'text' : 'password'"
            formControlName="confirmPassword"
          />
          <button
            mat-icon-button
            matSuffix
            (click)="showConfirmPassword = !showConfirmPassword"
            [attr.aria-label]="'Show confirm password'"
            [attr.aria-pressed]="showConfirmPassword"
          >
            <mat-icon>{{
              showConfirmPassword ? "visibility" : "visibility_off"
            }}</mat-icon>
          </button>

          <mat-error
            *ngIf="
              registerForm.get('confirmPassword')?.hasError('required') &&
              registerForm.get('confirmPassword')?.touched
            "
          >
            {{ "ERRORS.REQUIRED" | translate }}
          </mat-error>
        </mat-form-field>

        <!--NOT MATCHING PASSWORDS-->
        <div class="lg:col-span-4 sm:col-span-2">
          <mat-error
            *ngIf="
           registerForm.get('confirmPassword')?.touched &&
    registerForm.errors?.['passwordMismatch']  
          "
          >
            {{ "ERRORS.PASSWORD_MISMATCH" | translate }}
          </mat-error>
        </div>
        <!--SUBMIT BUTTON-->
        <div class="lg:col-span-4 sm:col-span-2 flex justify-end mt-4">
          <button
            mat-raised-button
            color="primary"
            type="submit"
            [disabled]="registerForm.invalid"
            (click)="submitForm()"
          >
            {{ "REGISTER.SUBMIT" | translate }}
          </button>
        </div>
      </div>
    </form>
  </mat-card>
</div>
<ng-template #userSummary let-data="data">
  <app-summary [data]="currentUser"></app-summary>
</ng-template>
