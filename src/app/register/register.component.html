<div class="container">
  <mat-card class="m-4 p-4">
    <mat-card-header>
      <mat-card-title>{{ "TITLE" | translate }}</mat-card-title>
    </mat-card-header>

    <form [formGroup]="registerForm">
      <mat-form-field appearance="fill" class="full">
        <mat-label>{{ "REGISTER.FULLNAME" | translate }}</mat-label>
        <input matInput formControlName="fullname" />
        <mat-error
          *ngIf="
            registerForm.get('fullname')?.touched &&
            registerForm.get('fullname')?.hasError('required')
          "
        >
          {{ "ERRORS.REQUIRED" | translate }}
        </mat-error>
        <mat-error
          *ngIf="
            registerForm.get('fullname')?.touched &&
            registerForm.get('fullname')?.hasError('minlength')
          "
        >
          {{ "ERRORS.MIN_LENGTH" | translate : { length: 3 } }}
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="fill" class="full">
        <mat-label>{{ "REGISTER.EMAIL" | translate }}</mat-label>
        <input matInput formControlName="email" />
        <mat-error
          *ngIf="
            registerForm.get('email')?.touched &&
            registerForm.get('email')?.hasError('required')
          "
        >
          {{ "ERRORS.REQUIRED" | translate }}
        </mat-error>
        <mat-error
          *ngIf="
            registerForm.get('email')?.touched &&
            registerForm.get('email')?.hasError('email')
          "
        >
          {{ "ERRORS.INVALID_EMAIL" | translate }}
        </mat-error>
      </mat-form-field>
      <mat-form-field appearance="fill" class="full">
        <mat-label>{{ "REGISTER.PHONE_PREFIX" | translate }}</mat-label>
        <input matInput formControlName="phone_prefix" />
        <mat-error
          *ngIf="
            registerForm.get('phone_prefix')?.touched &&
            registerForm.get('phone_prefix')?.hasError('required')
          "
        >
          {{ "ERRORS.REQUIRED" | translate }}
        </mat-error>
        <mat-error
          *ngIf="
            registerForm.get('phone_prefix')?.touched &&
            registerForm.get('phone_prefix')?.hasError('pattern')
          "
          >{{ "ERRORS.PHONE_PREFIX_PATTERN" | translate }}
        </mat-error>
      </mat-form-field>
      <mat-form-field appearance="fill" class="full">
        <mat-label>{{ "REGISTER.PHONE_NUMBER" | translate }}</mat-label>
        <input matInput formControlName="phone_number" mask="000-0000" />
        <mat-error
          *ngIf="
            registerForm.get('phone_number')?.touched &&
            registerForm.get('phone_number')?.hasError('required')
          "
        >
          {{ "ERRORS.REQUIRED" | translate }}
        </mat-error>
      </mat-form-field>
      <mat-form-field appearance="fill" class="full">
        <mat-label>{{ "REGISTER.DATE_OF_BIRTH" | translate }}</mat-label>
        <input
          matInput
          (click)="picker.open()"
          [matDatepicker]="picker"
          formControlName="date_of_birth"
        />
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
        <mat-error
          *ngIf="
            registerForm.get('date_of_birth')?.touched &&
            registerForm.get('date_of_birth')?.hasError('required')
          "
        >
          {{ "ERRORS.REQUIRED" | translate }}
        </mat-error>
         <mat-error
          *ngIf="
            registerForm.get('date_of_birth')?.touched &&
            registerForm.get('date_of_birth')?.hasError('minAge')
          "
        >
          {{ "ERRORS.MIN_AGE" | translate }}
        </mat-error>
      </mat-form-field>
      <mat-form-field appearance="fill" class="full">
        <mat-label>{{ "REGISTER.COUNTRY" | translate }}</mat-label>
        <mat-select formControlName="country">
          <mat-option *ngFor="let country of countries" [value]="country.name">
            {{ country.name }}
          </mat-option>
        </mat-select>

        <mat-icon matSuffix>public</mat-icon>
        <mat-error
          *ngIf="
            registerForm.get('country')?.touched &&
            registerForm.get('country')?.hasError('required')
          "
        >
          {{ "ERRORS.REQUIRED" | translate }}
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="fill" class="full">
        <mat-label>{{ "REGISTER.PASSWORD" | translate }}</mat-label>
        <input
          matInput
          [type]="showPassword ? 'text' : 'password'"
          formControlName="password"
        />
        <button
          mat-icon-button
          matSuffix
          (click)="showPassword = !showPassword"
          [attr.aria-label]="'Show password'"
          [attr.aria-pressed]="showPassword"
        >
          <mat-icon>{{
            showPassword ? "visibility" : "visibility_off"
          }}</mat-icon>
        </button>

        <mat-error
          *ngIf="
            registerForm.get('password')?.touched &&
            registerForm.get('password')?.hasError('required')
          "
        >
          {{ "ERRORS.REQUIRED" | translate }}
        </mat-error>
        <mat-error
          *ngIf="
            registerForm.get('password')?.touched &&
            registerForm.get('password')?.hasError('minlength')
          "
        >
          {{ "ERRORS.MIN_LENGTH" | translate : { length: 8 } }}
        </mat-error>
        <mat-error
          *ngIf="
            registerForm.get('password')?.touched &&
            registerForm.get('password')?.hasError('passwordStrength') &&
            !registerForm.get('password')?.hasError('minlength')
          "
        >
          {{ "ERRORS.PASSWORD_STRENGTH" | translate }}
        </mat-error>
      </mat-form-field>
      <mat-form-field appearance="fill" class="full">
        <mat-label>{{ "REGISTER.CONFIRM_PASSWORD" | translate }}</mat-label>
        <input
          matInput
          [type]="showConfirmPassword ? 'text' : 'password'"
          formControlName="confirmPassword"
        />
        <button
          mat-icon-button
          matSuffix
          (click)="showConfirmPassword = !showConfirmPassword"
          [attr.aria-label]="'Show confirm password'"
          [attr.aria-pressed]="showConfirmPassword"
        >
          <mat-icon>{{
            showConfirmPassword ? "visibility" : "visibility_off"
          }}</mat-icon>
        </button>

        <mat-error
          *ngIf="
            registerForm.get('confirmPassword')?.hasError('required') &&
            registerForm.get('confirmPassword')?.touched
          "
        >
          {{ "ERRORS.REQUIRED" | translate }}
        </mat-error>
       
      </mat-form-field>
       <mat-error
          *ngIf="
           registerForm.get('confirmPassword')?.touched &&
    registerForm.errors?.['passwordMismatch']  
          "
        >
          {{ "ERRORS.PASSWORD_MISMATCH" | translate }}
        </mat-error>
      <button
        mat-raised-button
        color="primary"
        type="submit"
        [disabled]="registerForm.invalid"
        (click)="submitForm()"
      >
        {{ "REGISTER.SUBMIT" | translate }}
      </button>
    </form>
  </mat-card>
</div>
<ng-template #userSummary let-data="data">
  <app-summary [data]="currentUser"></app-summary>
</ng-template>